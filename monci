#!/usr/bin/python3

import logging
import moncic
from moncic import cli
from moncic import ci


log = logging.getLogger(__name__)


def main():
    parser = cli.ArgumentParser(description="CI tool")
    parser.add_argument("--version", action="version", version=moncic.__version__)
    parser.add_argument(
        "-v",
        "--verbose",
        action="store_true",
        help="verbose output",
        shared=True,
    ),
    parser.add_argument(
        "--debug",
        action="store_true",
        help="debugging output",
        shared=True,
    ),
    subparsers = parser.add_subparsers(help="sub-command help", dest="handler", required=True)

    ci.CI.make_subparser(subparsers)
    ci.Image.make_subparser(subparsers)
    ci.Images.make_subparser(subparsers)
    ci.Distros.make_subparser(subparsers)
    ci.Bootstrap.make_subparser(subparsers)
    ci.Update.make_subparser(subparsers)
    ci.Remove.make_subparser(subparsers)
    ci.Shell.make_subparser(subparsers)
    ci.Run.make_subparser(subparsers)
    ci.Dedup.make_subparser(subparsers)
    ci.Analyze.make_subparser(subparsers)

    args = parser.parse_args()
    handler = args.handler(args)
    return handler.run()


if __name__ == "__main__":
    cli.run(main)
